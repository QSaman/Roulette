\documentclass{book} 

\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{float}
\usepackage{hyperref}
\usepackage{placeins}
\usepackage{amssymb}
\usepackage{listings}
\usepackage{hyperref}
% For tables:
\usepackage{booktabs}

\usepackage{tikz}
\usetikzlibrary{arrows}
\usetikzlibrary{snakes}
\usetikzlibrary{decorations.pathmorphing}

\hypersetup{colorlinks=true,linkcolor=blue, linktocpage}

\title{Roulette}
\author{Saman Saadi}
\date{}

\lstdefinestyle{customcpp}{
	belowcaptionskip=1\baselineskip,
	breaklines=true,
	frame=L,
	xleftmargin=\parindent,
	language=C++,
	frame=single,
	showstringspaces=false,
	basicstyle=\footnotesize\ttfamily,
	keywordstyle=\bfseries\color{green!40!black},
	commentstyle=\itshape\color{purple!40!black},
	identifierstyle=\color{black},
	stringstyle=\color{orange},
	emph={int,char,double,float,unsigned, auto},
	emphstyle={\color{blue}}
}

\lstset{escapechar=@,style=customcpp}

\begin{document}
	\frontmatter
	\maketitle
	\mainmatter
	\section{Summary}
	Let's assume we want to bet for the round $i^{th}$ in a game and our target profit is \$$p$ for each round until we win. So far we lost in the previous rounds. We call The amount of bet in $i^{th}$ round, $b_i$:
	\begin{equation*}
		b_i = 2 \times b_{i - 1}
	\end{equation*}
	Or we can say:
	\begin{equation*}
		b_i = (2^{i - 1}) \times p
	\end{equation*}
	In other words, if our previous bet was $x$, we should bet $2 \times x$ this time!
	\par If we want to afford to lose ${n - 1}$ times in a row and win in the $n^{th}$ round, our budget should be:
	\begin{equation*}
		budget = (2^n - 1) \times p
	\end{equation*}
	\section{Expected value}
	The American roulette has 37 pockets and the Canadian has 36. We use $n$ for the number of pockets in the wheel. Let's assume we bet on $c$ numbers. For example for betting on number $1$, $c = 1$ and for a red number $c = 18$. The payout is $36 - c$ to $c$. That means for every \$$c$ bet, we get \$$36 - \$c$. We also receive the original \$$c$. So our total balance for \$$1$ if we would win is:
	\begin{equation*}
		\begin{split}
			&\frac{36 - c + c}{c} \\
			&= \frac{36}{c}
		\end{split}
	\end{equation*}
	If we lose, we lose \$$1$. So the expected value is:
	\begin{equation*}
		\begin{split}
			E &= \frac{36 - c}{c} \times \frac{c}{n} - \frac{c}{c} \times \frac{n - c}{n} \\
			&= \frac{36 - c}{n} - \frac{n - c}{n} \\
			&= \frac{36 - n}{n} \\
			&= \frac{36}{n} - 1
		\end{split}
	\end{equation*}
	As you can see the expected value is not related to our choice! If we have 36 pockets, it's zero and we can call it a fair game. In Canada it's $\frac{36}{37} - 1 = -0.027$ and in the US it's $\frac{36}{38} - 1 = -0.053$. In other words, in Canada on average we should lose 3 cents per dollar and in US, 5 cents per dollar.
	\par As an example, let's assume we have 3 chips with the value of \$$\frac{1}{3}$. We bet one of them on black, the other on an even number and the other on a number greater than 18. Note that all of our bets are in the same round. we assume $p = \frac{c}{n}$. The expected value is:
	\begin{equation*}
		\begin{split}
			E &= \underbrace{\frac{3}{3} \times p^3}_{\text{3 wins}} \\
			  &+ \underbrace{(\frac{2}{3} - \frac{1}{3}) \times \binom{3}{2} \times p^2 \times (1 - p)}_{\text{2 wins and 1 loss}} \\
			  &+ \underbrace{(\frac{1}{3} - \frac{2}{3}) \times \binom{3}{2} \times p \times (1 - p)^2}_{\text{1 win and 2 losses}} \\
			  &+ \underbrace{(-\frac{3}{3}) \times (1 - p)^3}_{\text{3 losses}} \\
			  &= p^3 + \frac{1}{3} \times 3 \times p^2 \times (1 - p) - \frac{1}{3} \times 3 \times p \times (1 - p)^2 - (1 - p)^3 \\
			  &= p^3 + p^2 \times (1 - p) - p \times (1 - p)^2 - (1 - p)^3 \\
			  &= 2 \times p - 1
		\end{split}
	\end{equation*}
	Note that we should multiply the probability by $\binom{3}{2}$ when we have 2 wins and 1 loss. Because the status of the chips is one of the three sequences ($W$ means win and $L$ means loss):
	\begin{equation*}
		\begin{split}
		WWL \\
		WLW \\
		WWL \\
		\end{split}		
	\end{equation*}
	The probablity of each of these sequenes is $p^2 \times (1 - p)$. We use the same logic for 2 losses and 1 win.
	\par Now let's assume we have 2 chips with the value of \$$\frac{1}{2}$. We bet one of them on black and the other on an even number in the same round. The expected value is:
	\begin{equation*}
		\begin{split}
			E &= (\frac{1}{2} + \frac{1}{2}) \times p^2 \\
			&+ (\frac{1}{2} - \frac{1}{2}) \times \binom{2}{1} \times p * (1 - p) \\
			&+(-\frac{1}{2} - \frac{1}{2}) \times (1 - p)^2 \\
			&= p^2 - (1 - p)^2 \\
			&= 2 \times p - 1
		\end{split}
	\end{equation*}
	\par Now let's assume we have a chip of value \$$1$ and we bet on a black number. The expected value is:
	\begin{equation*}
		\begin{split}
			E &= 1 \times p - 1 \times (1 - p) \\
			&= 2 \times p - 1			
		\end{split}
	\end{equation*}
	So it doesn't matter what we choose, we are going to lose $2 \times p - 1 = -0.027$ per dollar in Canada! It's almost $3$ cents per dollar.
	\section{Chance of winning}
	In each round the change of winning in Canada is $\frac{18}{37} \simeq 49\%$ and the chance of loss is $\frac{19}{37} \simeq 51\%$. In the US the chance of winning is $\frac{18}{38} \simeq 47\%$ and the chance of loss is $\frac{20}{38} \simeq 53\%$.
	\par Please refer to this \href{https://www.youtube.com/watch?v=56iFMY8QW2k}{MIT lecture} For a more detailed explanation.
	\subsection{Playing only one round}
	Let's assume we only play 1 round. No matter what is the result, we leave casino at the end of the first round. In Canada $p = \frac{18}{37}$ and in the US $p = \frac{18}{38}$. In other words we only play for 1 to 1 payout like betting on colors.
	\subsubsection{One chip}
	The probability of win is $p$ and the loss is $1 - p$. \\
	\par
	\begin{tabular}[h!]{c c c}
		\toprule
		Country & Win & Loss \\
		\midrule
		Canada & 49\% & 51\% \\
		US & 47\% & 53\% \\
		\bottomrule
	\end{tabular} \\
	\subsubsection{Two chips}
	\label{subsubsection_two_chips}
	Let's say we have two chips with the same value. We bet the first chip on black and the second on an even number. If one of the chips wins and the other loses, it's a tie. So we don't gain or lose money. So we have:
	\begin{equation*}
		\begin{split}
			\text{Win} &= p^2 \\
			\text{Loss} &= (1 - p)^2 \\
			\text{Tie} &= \binom{2}{1} \times p \times (1 - p) = 2 \times p \times (1 - p)
		\end{split}
	\end{equation*}
	So we have: \\
	\par 
	\begin{tabular}[h!]{c c c c}
		\toprule
		Country & Win & Loss & Tie \\
		\midrule
		Canada & 24\% & 26\% & 50\% \\
		US & 22\% & 28\% & 50\% \\
		\bottomrule
	\end{tabular} \\
	\par Note that in Canada the chance of not losing money is 74\% and in the US is 72\%.
	\par Let's try to improve our approach. We have payouts like choosing a color that is 1 to 1 and choosing a column that is 2 to 1. The probability of the former is $p = \frac{18}{n}$ and the latter is $q = \frac{12}{n}$. We bet chip $H$ with value $d$ on black number and we bet chip $L$ with value $x$ on the first column. We want to find $x$ in such a way that if $H$ loses and $L$ wins, it's a tie. On the other hand, if $H$ wins and $L$ loses, it's a win. So we should have $x < d$. Let's find the value of $x$:
	\begin{equation*}
		\begin{split}
			\underbrace{-x -d}_\text{bet} + x + 2 \times x &= 0 \\
			\implies x = \frac{d}{2}			
		\end{split}
	\end{equation*}
	So we can assume the value of $L$ is $d$ and the value of $H$ is $2d$. We bet $L$ on the first column with payout 2 to 1 and we bet $H$ on black with payout 1 to 1. Let's assume $WL$ means $H$ wins its bet and $L$ loses its bet. The profit will be:
	\begin{equation*}
		\begin{split}
			WW &= \underbrace{2d}_\text{H} + \underbrace{2d}_\text{L} = 4d \\
			WL &= \underbrace{2d}_\text{H} \underbrace{-d}_\text{L} = d \\
			LW &= \underbrace{-2d}_\text{H} + \underbrace{2d}_\text{L} = 0 \\
			LL &= -2d - d = -3d
		\end{split}
	\end{equation*}
	Now we can have a table like this that $W$ means win, $L$ loss and $T$ tie: \\
	\par
	\begin{tabular}[h!]{c c c c c c}
		\toprule
		H & L & Wins & Profit & Result & Chance \\
		\midrule
		W & W & 2 & 4d & W & 16\% \\
		W & L & 1 & d & W & 33\% \\
		L & W & 1 & 0 & T & 16\% \\
		L & L & 0 & -3d & L & 35\% \\
		\bottomrule
	\end{tabular} \\	
	\par The probability of win is:
	\begin{equation*}
		\begin{split}
			\text{win} &= p \times q \\
			&+ p \times (1 - q) \\
			&= p
		\end{split}
	\end{equation*}
	For the tie:
	\begin{equation*}
		\begin{split}
			\text{tie} &= (1 - p) \times q
		\end{split}
	\end{equation*}
	For the loss:
	\begin{equation*}
		\begin{split}
			\text{loss} &= (1 - p) \times (1 - q)
		\end{split}
	\end{equation*}
	So we have: \\
	\par 
	\begin{tabular}[h!]{c c c c}
		\toprule
		Country & Win & Loss & Tie \\
		\midrule
		Canada & 49\% & 35\% & 16\% \\
		US & 47\% & 36\% & 17\% \\
		\bottomrule
	\end{tabular} \\
	\par
	So the chance of not losing in Canada is 65\% and in the US is 64\%. Let's calculate the expected value. We assume the value of $H$ is $\frac{2}{3}$ and the value of $L$ is $\frac{1}{3}$. For calculation we assume it's a Canadian casino:
	\begin{equation*}
		\begin{split}
			E(\text{win}) &= (\frac{2}{3} + \frac{2}{3}) \times p \times q \\
			&+ (\frac{2}{3} - \frac{1}{3}) \times p \times (1 - q) \\
			&= 0.31994
		\end{split}
	\end{equation*}
	\begin{equation*}
		\begin{split}
			E(\text{loss}) &= (-\frac{2}{3} - \frac{1}{3}) \times (1 - p) \times (1 - q) \\
			&= -0.34696859
		\end{split}
	\end{equation*}
	So the expected value is $-0.0270$. This is exactly $\frac{36}{n} - 1$. As we mentioned before, no matter what we choose, the expected value is always the same!
	\subsubsection{Three chips}
	Let's say we have 3 chips with the same value. We bet the first chip on black and the second on an even number and the third on the first 18 numbers.
	\par At least 2 chips should be in win status to get money; otherwise we lose money. Unlike previous case, there is no tie here. So we have:
	\begin{equation*}
		\begin{split}
			\text{Win} &= p^3 + \binom{3}{2} \times p^2 \times (1 - p) \\
			\text{Loss} &= (1 - p)^3 + \binom{3}{2} \times p \times (1 - p)^2
		\end{split}
	\end{equation*}
	So we have: \\
	\par
	\begin{tabular}[h!]{c c c}
	\toprule
	Country & Win & Loss \\
	\midrule
	Canada & 48\% & 52\% \\
	US & 46\% & 54\% \\
	\bottomrule
\end{tabular} \\
	\par
	\par As you can see this is worse than 1 chip! Since there is no tie here, we cannot improve it.
	\subsubsection{Four chips}
	Since the number of chips are even, we have tie here. We can use the same approach like we did or two chips in \ref{subsubsection_two_chips}. We should turn some ties into win situtations. Let's assume we have chip $L$ with value $x$ and chips $H_1$, $H_2$, and $H_3$ with value $d$. We know that $x < d$ so this method works. Let's find $x$:
	\begin{equation*}
		\begin{split}
			\underbrace{-3 \times d - x}_\text{bet} + d + d +x + 2x &= 0 \\
			\implies x &= \frac{d}{2}
		\end{split}
	\end{equation*}
	Let's assume we have chip $L$ with value \$$d$ and three chips $H_1, H_2$ and $H_3$ with value \$$2d$. We bet $L$ on column 1 with probability $q = \frac{12}{n}$. The payout is 2 to 1. We bet the other chips as before with payout 1 to 1. We can win ($T$), lose ($L$) or tie ($T$). The chance column is based on a Canadian casino: \\
	\par
	\begin{tabular}[h!]{c c c c c c c c}
		\toprule
		$H_1$ & $H_2$ & $H_3$ & L & Wins & Balance & Result & Chance \\
		\midrule
		W & W & W & W & 4 & 8d & W & 4\% \\
		W & W & W & L & 3 & 5d & W & 8\% \\
		L & W & W & W & 3 & 4d & W & 12\% \\
		L & W & W & L & 2 & d & W & 25\% \\
		L & L & W & W & 2 & 0 & T & 12\% \\
		L & L & W & L & 1 & -3d & L & 26\% \\
		L & L & L & W & 1 & -4d & L & 4\% \\
		L & L & L & L & 0 & -7d & L & 9\% \\
		\bottomrule
	\end{tabular} \\	
	\par
	For example for winning all the chips our balance will be:
	\begin{equation*}
		\begin{split}
			\text{Balance} &= \underbrace{3 \times -2d - d}_\text{bet} + \underbrace{3 \times 4d}_\text{$H_1$ to $H_3$} + \underbrace{d + 2d}_\text{L} \\
			&= 8d
		\end{split}
	\end{equation*}
	Th probabilities are:
	\begin{equation*}
		\begin{split}
			\text{Win} &= \underbrace{p^3 \times q}_{\text{4 wins}} \\
			&+ \underbrace{p^3 \times (1 - q)}_\text{3 wins} \\
			&+ \underbrace{\binom{3}{2} \times p^2 \times (1 - p) \times q}_\text{3 wins} \\
			&+ \underbrace{\binom{3}{2} \times p^2 \times (1 - p) \times (1 - q)}_\text{2 wins} \\
		\end{split}
	\end{equation*}
	For tie:
	\begin{equation*}
		\text{Tie} = \underbrace{\binom{3}{1} \times p * (1 - p)^2 \times q}_\text{2 wins}
	\end{equation*}
	For loss:
	\begin{equation*}
		\begin{split}
			\text{Loss} &= \underbrace{\binom{3}{1} \times p \times (1 - p)^2 \times (1 - q)}_\text{1 win} \\
			&+ \underbrace{(1 - p)^3 \times q}_\text{1 win} \\
			&+ \underbrace{(1 - p)^3 \times (1 - q)}_\text{0 win}
		\end{split}
	\end{equation*}
	So we have: \\
	\par 
	\begin{tabular}[h!]{c c c c}
		\toprule
		Country & Win & Loss & Tie \\
		\midrule
		Canada & 48\% & 40\% & 12\% \\
		US & 46\% & 42\% & 12\% \\
		\bottomrule
	\end{tabular} \\
	\par In Canada the chance of not losing money is 60\% and in the US is 58\%. We can also calculate the expected value. We assume $d = \frac{1}{7}$ so the value of all 4 chips is 1 dollar. Again we are assuming it's a Canadian casino:
	\begin{equation*}
		\begin{split}
			E(\text{win}) &= (3 \times \frac{2}{7} + \frac{2}{7}) \times p^3 \times q \\
			&+ (3 \times \frac{2}{7} - \frac{1}{7}) \times p^3 \times (1 - q) \\
			&+ (2 \times \frac{2}{7} - \frac{2}{7} + \frac{2}{7}) \times 3 \times p^2 \times (1 - p) \times q \\
			&+ (2 \times \frac{2}{7} - \frac{2}{7} - \frac{1}{7}) \times 3 \times p^2 \times (1 - p) \times (1 - q) \\
			&= 0.201
		\end{split}
	\end{equation*}
	and for the loss:
	\begin{equation*}
		\begin{split}
			E(\text{loss}) &= (\frac{2}{7} - 2 \times \frac{2}{7} - \frac{1}{7}) \times 3 \times p \times (1 - p)^2 \times (1 - q) \\
			&+ (-3 \times \frac{2}{7} + \frac{2}{7}) \times (1 - p)^3 \times q \\
			&+ (-3 \times \frac{2}{7} - \frac{1}{7}) \times (1 - p)^3 \times (1 - q) \\
			&= -0.228
		\end{split}
	\end{equation*}
	So in total we have:
	\begin{equation*}
		E = E(\text{win}) + E(\text{loss}) = -0.027
	\end{equation*}
	This is exactly $E = \frac{36}{n} - 1$. No matter what choices we make, we are going to lose money on average.
	\section{General case}
	Let's assume we are in round $i^{th}$ of a game. We can calculate the balance for round $i$ that we call it $b_i$. We want to make $p$ unrealized profit/loss for this game, assuming we eventually win in this round
	\subsection{Mathematical induciton}
	We define $b_i$ as the amount of bet for round $i$ in such a way that if we win round $i$, our total profit for this game would be $p$. We use mathematical induciton and we assume we know how to solve $b_{i - 1}$.
	\subsubsection{When $b_{i - 1} < 0$}
	Let's assume we will win at the end of round $i$ and our profit will be $p$. In round $i - 1$ we lost $b_{i - 1}$ so we just need to spend $b_{i - 1}$ to cancel it. We use mathematical hypotheis and spend another $b_{i - 1}$ to cancel losses for rounds $1$ to $i - 2$ and gain $p$ at the end of the round (assuming we will win): 
	\begin{equation*}
		\begin{split}
			b_i &= \sum_{j = 0}^{i - 1}{b_j} - p \\
			&= \underbrace{\sum_{j = 0}^{i - 2}{b_j} - p}_{b_{i - 1}} + b_{i - 1} \\
			&= 2 \times b_{i - 1}
		\end{split}
	\end{equation*}
	\subsubsection{When $b_{i - 1} \ge 0$}
	Note that if $b_{i - 1} \ge p$, we've already achieved our goal and no need to continue the game for the profit $p$. We may increase the target profit to a more ambition one later.
	\par Let's assume $b_{i - 1} > 0 \land b_{i - 1} < p$ and we will win at the end of round $i$ and our profit will be $p$:
	\begin{equation*}
		\begin{split}
			b_{i - 1} + \underbrace{x}_{bet} \underbrace{- 2 \times x}_{rewards} &=  p \\
			\implies x &= b_{i - 1} - p
		\end{split}
	\end{equation*}
	So we just need to bet on $b_{i - 1} - p$ and if we win this round our profit will be $p$.
	\subsection{General Formula}
	\begin{equation*}
		b_i = \begin{cases}
			2 \times b_{i - 1} & b_{i - 1} < 0 \\
			b_{i - 1} - p & b_{i - 1} \ge 0 \land b_{i - 1} < p \\
			b_{i - 1} & b_{i - 1} \ge 0 \land b_{i - 1} \ge p \\
			b_0 -p & i = 1
		\end{cases}	
	\end{equation*}
	Note that we define $b_1 = b_0 - p$. Usually $b_0 = 0$, but if in the round $k$ we decide to change $p$ to $p^{\prime}$. Then we can initiate a new game with $b_0 = b_k$ and profit $p^\prime$.  
	\section{Losing all previous rounds}
	Let's consider the worst case scenario and we are going to lose in $n$ rounds in a row:
	\begin{equation*}
		\begin{split}
			b_0 &= 0 \\
			b_1 &= b_0 - p = -p \\
			b_2 &= 2 \times b_1 = -2p \\
			b_3 &= 2 \times b_2 = -4p \\
			b_4 &= 2 \times b_3 = -8p \\
			&\vdots \\
			b_{n} &= 2 \times b_{n - 1} = -2^{n - 1} \times p
	     \end{split}
	\end{equation*}
	\section{Budget for $n$ rounds}
	Now let's calculate what should be our budget if we can afford to lose in ${n -1}$ rounds and win at round $n$. We assume $r_i$ is our loss in round $i^{th}$ for $1 \le i \le n - 1$
	\begin{equation*}
		\begin{split}
			budget &= -\sum_{i = 0}^{n}{b_i} \\
			&= \sum_{i = 0}^{n}{2^{i - 1} \times p} \\
			&= (2^n - 1) \times p
		\end{split}
	\end{equation*}
	Note that we use the following formula to get the budget:
	\begin{equation*}
		\sum_{i = 0}^{n}{2^i} = 2^{n + 1} - 1
	\end{equation*}
\end{document}
